# File backup date: 2024-12-20T18:34:51+00:00
---
- name: Copy a file to a remote server
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Copy a local file to the remote server
      copy:
        src: /home/sena/ansible/ansibleExercices/03-playbooks/copyFile.yml          # Path to the file on the local machine
        dest: /home/sena/ansible/ansibleExercices/03-playbooks/copyFile.yml.backup  # Path where the file will be copied on the remote server
        owner: sena                     # Set file owner (optional)
        group: sena                     # Set file group (optional)
        mode: '0644'                    # Set file permissions (optional)

    - name: Set current date variable
      set_fact:
        current_date: "{{ lookup('pipe', 'date --iso-8601=seconds') }}"

    - name: Add the current date at the beginning of the destination file
      lineinfile:
        path: /home/sena/ansible/ansibleExercices/03-playbooks/copyFile.yml.backup  # Destination file
        line: "# File backup date: {{ current_date }}"                                # Line to add
        insertbefore: BOF                                                           # Insert at the beginning of the file
        create: no    
